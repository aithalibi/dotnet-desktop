@page
@model Location_voiture_front_web.Pages.Auth.VerifyResetCodeModel
@{
    ViewData["Title"] = "Vérifier le code";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0"><i class="fas fa-shield-alt"></i> Vérification du code</h4>
                </div>
                <div class="card-body">
                    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
                    {
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i class="fas fa-exclamation-circle"></i> @Model.ErrorMessage
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    }

                    @if (!Model.CodeVerified)
                    {
                        <p class="text-muted">
                            Entrez le code à 6 chiffres que vous avez reçu par email.
                        </p>

                        <form method="post">
                            <input type="hidden" asp-for="Email" />

                            <div class="mb-3">
                                <label for="Code" class="form-label">Code de vérification</label>
                                <input type="text" class="form-control form-control-lg text-center" 
                                       id="Code" name="Code" asp-for="Code" 
                                       required maxlength="6" pattern="[0-9]{6}"
                                       placeholder="000000" 
                                       style="letter-spacing: 0.5em; font-size: 2rem; font-weight: bold;">
                                <span asp-validation-for="Code" class="text-danger"></span>
                                <small class="form-text text-muted">
                                    Le code expire après 15 minutes
                                </small>
                            </div>

                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-success btn-lg">
                                    <i class="fas fa-check"></i> Vérifier
                                </button>
                                <a asp-page="/Auth/ForgotPassword" class="btn btn-outline-secondary">
                                    <i class="fas fa-arrow-left"></i> Renvoyer un code
                                </a>
                            </div>
                        </form>
                    }
                    else
                    {
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i>
                            <strong>Code validé !</strong> Vous pouvez maintenant changer votre mot de passe.
                        </div>
                        
                        <div class="text-center mt-3">
                            <a asp-page="/Auth/ResetPassword" 
                               asp-route-email="@Model.Email" 
                               asp-route-code="@Model.Code"
                               class="btn btn-primary btn-lg">
                                <i class="fas fa-key"></i> Changer le mot de passe
                            </a>
                        </div>
                    }
                </div>
            </div>

            <div class="text-center mt-3">
                <small class="text-muted">
                    Vous n'avez pas reçu le code ? 
                    <a asp-page="/Auth/ForgotPassword">Renvoyer</a>
                </small>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Auto-focus sur le champ code
        document.getElementById('Code').focus();
        
        // Permettre seulement les chiffres
        document.getElementById('Code').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
        });
    </script>
}
