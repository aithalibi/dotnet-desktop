@page
@model IndexModel
@using Location_voiture_front_web.Models
@using Location_voiture_front_web.Services
@using System.Linq
@inject IVehiculeService VehiculeService
@inject IAuthService AuthService

@{
    ViewData["Title"] = "Catalogue Véhicules";
}

<div class="container-fluid py-5" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);">
    <div class="container">
        <div class="row mb-5">
            <div class="col-md-8">
                <h1 class="display-4 fw-bold mb-2">
                    <i class="fas fa-car text-primary"></i> Catalogue Véhicules
                </h1>
                <p class="lead text-muted">Découvrez notre large gamme de véhicules</p>
            </div>
            @if (Model.IsAdmin)
            {
                <div class="col-md-4 d-flex align-items-center justify-content-end">
                    <a href="/Vehicules/Create" class="btn btn-success btn-lg shadow">
                        <i class="fas fa-plus"></i> Ajouter Véhicule
                    </a>
                </div>
            }
        </div>

        @if (!string.IsNullOrEmpty(Model.Message))
        {
            <div class="alert @(Model.IsError ? "alert-danger" : "alert-success") alert-dismissible fade show" role="alert">
                <i class="fas @(Model.IsError ? "fa-exclamation-circle" : "fa-check-circle")"></i>
                @Model.Message
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        }

        @if (Model.Vehicules != null && Model.Vehicules.Any())
        {
            <div class="row g-4">
                @foreach (var vehicule in Model.Vehicules)
                {
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 shadow-sm border-0 vehicle-card">
                            <div style="position: relative; overflow: hidden; height: 240px;">
                                @if (!string.IsNullOrEmpty(vehicule.ImagePrincipaleUrl))
                                {
                                    <img src="@vehicule.ImagePrincipaleUrl" class="card-img-top" 
                                         alt="@(vehicule.Marque) @(vehicule.Modele)" style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s;">
                                }
                                else
                                {
                                    <div class="bg-light d-flex align-items-center justify-content-center" style="height: 100%;">
                                        <i class="fas fa-car fa-5x text-secondary"></i>
                                    </div>
                                }
                                <span class="badge @(vehicule.EstDisponible ? "bg-success" : "bg-danger")" 
                                      style="position: absolute; top: 10px; right: 10px; z-index: 10;">
                                    @(vehicule.EstDisponible ? "Disponible" : "Non disponible")
                                </span>
                            </div>

                            <div class="card-body">
                                <h5 class="card-title fw-bold">@vehicule.Marque @vehicule.Modele</h5>
                                <p class="card-text text-muted small mb-3">@vehicule.Immatriculation</p>

                                <div class="row text-center mb-3 g-2">
                                    <div class="col-6">
                                        <small class="d-block text-muted">Année</small>
                                        <strong>@vehicule.Annee</strong>
                                    </div>
                                    <div class="col-6">
                                        <small class="d-block text-muted">Couleur</small>
                                        <strong>@(vehicule.Couleur ?? "N/A")</strong>
                                    </div>
                                </div>

                                <hr>

                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <span class="badge bg-primary h5 mb-0">@vehicule.PrixJournalier.ToString("C")</span>
                                    <small class="text-muted">/jour</small>
                                </div>

                                <div class="d-flex gap-2">
                                    <a href="/Vehicules/Detail?id=@vehicule.Id" class="btn btn-sm btn-primary flex-grow-1">
                                        <i class="fas fa-eye"></i> Détails
                                    </a>
                                    @if (vehicule.EstDisponible)
                                    {
                                        <a href="/Locations/Create?vehiculeId=@vehicule.Id" class="btn btn-sm btn-success flex-grow-1">
                                            <i class="fas fa-calendar-plus"></i> Louer
                                        </a>
                                    }
                                @if (Model.IsAdmin)
                                {
                                    <a href="/Vehicules/Edit?id=@vehicule.Id" class="btn btn-warning btn-sm">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a href="#" onclick="deleteVehicule(@vehicule.Id)" class="btn btn-danger btn-sm">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                }
                            </div>
                        </div>

                        <div class="card-footer bg-light">
                            @if (vehicule.EstDisponible)
                            {
                                <span class="badge bg-success">Disponible</span>
                            }
                            else
                            {
                                <span class="badge bg-danger">Non disponible</span>
                            }
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="alert alert-info text-center" role="alert">
            <i class="fas fa-info-circle"></i> Aucun véhicule trouvé
        </div>
    }
</div>

@section Scripts {
    <script>
        async function deleteVehicule(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer ce véhicule?')) {
                try {
                    const response = await fetch(`/api/Vehicules/${id}`, {
                        method: 'DELETE'
                    });
                    if (response.ok) {
                        location.reload();
                    } else {
                        alert('Erreur lors de la suppression');
                    }
                } catch (error) {
                    alert('Erreur: ' + error);
                }
            }
        }
    </script>
}


